async function getCookies(e,t){return t?await chrome.cookies.get({url:e,name:t}):await chrome.cookies.getAll({url:e})}async function doConnect(e){const t=await getCookies("https://salework.net","evn-token");t&&t.value||alert("Vui lòng đăng nhập tài khoản Salework!"),await checkCurrentShopeeSession(e,t)}async function checkCurrentShopeeSession(e,t){const n=await getCookies("https://shopee.vn");let o="";for(const e of n)o=o.concat(e.name).concat("=").concat(e.value).concat(";");const s={"evn-token":t?t.value:"","target-shop":e,"shopee-cookie":o},c=new XMLHttpRequest;c.onreadystatechange=async function(){if(4===this.readyState)if(200===this.status){this.response.data.success?(await getConnectedShopsAndCurrentShopeeSession(),document.getElementById("msg-success").innerText="Liên kết thành công!"):(await clearShopeeCookies(n),document.getElementById("msg-fail").innerText="Liên kết không thành công!")}else await clearShopeeCookies(n)},c.responseType="json",c.open("post","https://ads.salework.net/api/extension/connect",!0),c.setRequestHeader("Content-Type","application/json;charset=UFT-8"),c.setRequestHeader("Accept","application/json"),c.send(JSON.stringify(s))}async function clearShopeeCookies(e){confirm("Vui lòng đăng nhập tài khoản Shopee cần liên kết và thao tác lại!")&&(e&&await Promise.all(e.map((async e=>{await chrome.cookies.remove({url:"https://shopee.vn",name:e.name},(()=>{}))}))),window.open("https://shopee.vn/seller/login"))}async function getConnectedShopsAndCurrentShopeeSession(){const e=await getCookies("https://salework.net","evn-token");e&&e?.value||confirm("Vui lòng đăng nhập tài khoản Salework cần liên kết và thao tác lại!")&&window.open("https://salework.net/login/");const t=await getCookies("https://shopee.vn");let n="";for(const e of t)n=n.concat(e.name).concat("=").concat(e.value).concat(";");const o=new XMLHttpRequest;o.onreadystatechange=function(){if(4===this.readyState&&200===this.status){const e=this.response.data,t=e.sw_username,n=document.getElementById("connected"),o=document.getElementById("current");for(;n.firstChild;)n.firstChild.remove();for(;o.firstChild;)o.firstChild.remove();e?.shops.forEach((e=>{const o=document.createElement("tr"),s=document.createElement("i");s.classList.add("glyphicon","glyphicon-ok","text-success");const c=document.createElement("i");c.classList.add("glyphicon","glyphicon-refresh","text-danger"),c.style.cursor="pointer",c.addEventListener("click",(()=>{doConnect(e.username)}));const i=document.createElement("img");i.style.marginTop="-6px",i.style.marginRight="10px",i.src="icon/ads.png",i.height=15,i.width=15;const a=document.createElement("img");a.style.marginTop="-6px",a.style.marginRight="10px",a.src="icon/shopee.png",a.height=19,a.width=19;const d=document.createElement("td");d.style.width="200px",d.appendChild(i),d.appendChild(document.createTextNode(t));const p=document.createElement("td");p.style.width="200px",p.appendChild(a),p.appendChild(document.createTextNode(e.username));const r=document.createElement("td");r.appendChild(e.forceReLogin?c:s),o.appendChild(d),o.appendChild(p),o.appendChild(r),n.appendChild(o)}));const s=e.sp_username||void 0,c=document.createElement("tr"),i=document.createElement("td");i.style.width="200px",c.appendChild(i);const a=document.createElement("td"),d=e?.shops.map((e=>e.username)).includes(s);if(d){const t=e?.shops.find((e=>e.username.toString()===s.toString()));if(t.forceReLogin){const e=document.createElement("i");e.classList.add("glyphicon","glyphicon-refresh","text-danger"),e.style.cursor="pointer",e.addEventListener("click",(()=>{doConnect(t.username)})),a.appendChild(e)}else{const e=document.createElement("i");e.classList.add("glyphicon","glyphicon-ok","text-success"),a.appendChild(e)}}else if(s){const e=document.createElement("i");e.classList.add("glyphicon","glyphicon-link","text-primary"),e.style.cursor="pointer",e.title="Bấm để liên kết",e.addEventListener("click",(()=>{doConnect(s)})),a.appendChild(e)}const p=document.createElement("td");p.style.width="200px";const r=document.createElement("img");r.style.marginTop="-6px",r.style.marginRight="10px",r.src="icon/shopee.png",r.height=19,r.width=19,p.appendChild(r),p.appendChild(document.createTextNode(s||"Chưa đăng nhập")),c.appendChild(p),c.appendChild(a),o.appendChild(c)}},o.responseType="json",o.open("post","https://ads.salework.net/api/extension/connected",!0),o.setRequestHeader("Content-Type","application/json;charset=UFT-8"),o.setRequestHeader("Accept","application/json"),o.send(JSON.stringify({"evn-token":e?.value,"shopee-cookie":n}))}document.getElementById("link-btn").addEventListener("click",(async function(){clearShopeeCookies(await getCookies("https://shopee.vn"))})),getConnectedShopsAndCurrentShopeeSession();